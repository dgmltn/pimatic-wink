pimatic-wink
============

Pimatic plugin to interface with Wink connected devices. Currently supports the following device types:
 1. light_bulb
 2. binary_switch
 3. shade
 4. light switch - this a varition on light_bulb and only offers on/off functionality. this will not be added automatically by discovery. If you want to use it you will have to do it manually, or you can change the class for WinkLightBulb by manually editing config.json file

This plugin suppports auto-discovery available since pimatic v0.91 and that is the preffered way of adding devices, it will retrieve all the parameters it needs from wink 

This version also subscribes to pubnub where wink publishes real-time device statutes - google 'wink pubnub' if you want further info.

The plugin should preferebaly installed using the pimatic UI functions available since v0.9 of pimatic.  After installing the plugin you should edit the parameters and set the username and password you use with the wink app, before you start auto-discovery process.  This will retrieve the OAuth token the plugin needs to make Wink API calls 

Plugin
------

    {
      "plugin": "wink",
      "client_id": "quirky_wink_android_app",
      "client_secret": "e749124ad386a5a35c0ab554a4f2c045",
      "username": "xxxxx@yyyyyyy.com",
      "password": "123456",
      "auth_token": "0000aaaaa99999988889999332211333"
    },

`client_id` and `client_secret` are used for OAuth token generation. 
You can email wink support and request a personalized `client_id` and `client_secret`, it's been known to take considerable time to get it, so these were taken from the Android Wink app, first seen here:

  https://github.com/davidgruhin/WinkPost/blob/master/js/wink.js#L335

`username` and `password` are those used to log in to the official Wink app.

`auth_token` is generated by accessing the Wink API - the plug will automatically do it, after setting the `username` and `password` restart pimatic to do this.  You can also retrieve this using the CLI - see usage not below 


Devices
-------
`device_id`, `pubnub_subscribe_key`, `pubnub_channel` and  to interact with devices and subscribe to status updates, if you use pimatic auto-discovery to add devices, these will be automatically populate this for you. You can also manually populate these by retrieving the device map using the CLI and looking it up in the device map

    {
      "id": "my-light-bulb",                //unique id used by pimatic
      "class": "WinkLightBulb",             //this should match the device type
      "name": "Office Light Bulb"           //call it what you want 
      "device_id": "212917",                //retrieved from Wink device map
      "pubnub_channel": "very_long_string", //retrieved from Wink device map   
      "pubnub_subscribe_key": "a_string"    //retrieved from Wink device map
    },
    {
      "id": "my-switch",
      "class": "WinkBinarySwitch",
      "name": "Outlet",
      "device_id": "718646",                 
      "pubnub_channel": "very_long_string",     
      "pubnub_subscribe_key": "a_string"     
    },
    {
      "id": "my-shade",
      "class": "WinkShade",
      "name": "Curtains",
      "device_id": "516323",                 
      "pubnub_channel": "very_long_string",     
      "pubnub_subscribe_key": "a_string" 
    },
    {
      "id": "my-floodlight",
      "class": "WinkLightSwitch",           //This MUST be a light_bulb type device 
      "name": "Curtains",
      "device_id": "201551",                 
      "pubnub_channel": "very_long_string",     
      "pubnub_subscribe_key": "a_string" 
    },



Bonus: CLI
----------
pimatic-wink includes a bonus utility that can be run from the command line (via `node`).
See wink-cli.js for more information.

Commands to retrive auth_token and device map - you don't need to do this manually, the plugin does this for you.  The auth_token will be retrieved in the first run after installing. Device can be retrieved using auto-discovery.

auth token :
node wink-cli.js auth_token 'xxxxx@yyyyyyy.com' '123456'

device map:
node wink-cli.js auth_token device_map



